---
dag_name: create_connectors
description: создаёт Airbyte Connections на основе данных из конфига connectors.
status: разработка не начата
doc_status: in progress
type: dag
---
там где это необходимо обеспечивают [идемпотентность](https://ru.wikipedia.org/wiki/%D0%98%D0%B4%D0%B5%D0%BC%D0%BF%D0%BE%D1%82%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D1%8C). Это означает, что если оператор  вызвать несколько раз подряд с одними и теми же аргументами, нужное действие будет выполнено один раз. Например, если несколько раз попытаться создать Airbyte Connection с одним и тем же именем, оно будет создано только в одном экземпляре.



**Решаемая задача:** создаёт Airbyte Connections на основе данных из конфига [[Airflow Providers/Configs/connectors|connectors]].

# Обзор

При запуске DAG создаёт Airbyte Connectors на основе входных данных. При этом обеспечивается [идемпотентность](https://ru.wikipedia.org/wiki/%D0%98%D0%B4%D0%B5%D0%BC%D0%BF%D0%BE%D1%82%D0%B5%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D1%8C). То есть если DAG  вызвать несколько раз подряд с одними и теми же аргументами, нужное действие будет выполнено один раз. Например, если несколько раз попытаться создать Airbyte Connection с одним и тем же именем, оно будет создано только в одном экземпляре.

Входные данные, со всеми необходимыми конфигами, формируются заранее с помощью DAG’а [[template_configs]].

# Используемые конфиги

`basic_config.connectors`  — словарь в формате yaml, содержащий информацию о идентификаторе коннектора, названии Docker-образа на DockerHub и ссылку на документацию для `source_definitions` и `destination_definitions`.

# Порядок работы

## Подготовка

Перед запуском этого DAG’а необходимо убедиться, что уже был запущен DAG template_configs и все необходимые входные данные собраны в `basic_config`.

На подготовительном шаге DAG, с помощью функции `get_configs(...)` (см. [[Configs#Конфигурация#Функция `get_configs(...)`]]), получает из `basic_configs` данные конфига [[Airflow Providers/Configs/connectors|connectors]].

Далее нужно проверить какие коннекторы уже созданы в Airbyte. Для этого выполняется запрос через API. В результате получаем текущее состояние системы (словарик) и сопоставляем его с конфигом connectors. Для сравнения предполагается использовать https://dictdiffer.readthedocs.io/en/latest/ 

Коннекторы в Airbyte добавляем все, какие перечислены в конфиге connectors, а не только для активных источников. 

## Формат результата на шаге `prepare`

Различия между текущим состоянием и конфигом connectors (update / create). Если я правильно поняла на выходе, после использования dictdiffer у нас будет список коннекторов которые нужно обновить до более новой версии и какие нужно создать с нуля.
## Операции в рамках итерации

Проходимся по всему что нужно обновить/создать (список будет). Одно обновление/создание = одна динамическая задача.

Данные, о коннекторе, который нужно создать/обновить, будут передаваться специальному оператору. При каждой итерации DAG будет его вызывать. 

# Результат

Добавление/обновление коннекторов в Airbyte.