---
category: sub_main
step: 4_graph
sub_step: 5_glue
in_main_macro: graph
doc_status: ready
---
# macro `graph_glue`

## Список используемых вспомогательных макросов
| Name           | Category  | In Sub-Main Macro     | Doc Status |
| -------------- | --------- | --------------------- | ---------- |
| [[calc_graph]] | auxiliary | graph_glue, graph_qid | ready      |

## Описание

Это пятый шаг макроса `graph`. После завершения `graph_edge`, `graph_glue` использует результаты этого макроса для объединения данных, связанных с узлами графа, и вычисления максимальных значений групповых идентификаторов для каждого узла.

## Аргументы

Этот макрос принимает следующие аргументы:
```sql
  params=none,
  stage_name=none,
  limit0=none
```
## Функциональность

Сначала в макросе происходит настройка материализации данных: устанавливается порядок сортировки данных по идентификатору узла слева. `pre_hook` указывает на необходимость выполнения предварительного хука при помощи вспомогательного макроса [[calc_graph]] перед выполнением запроса.

Далее в макросе происходит выборка уникальных идентификаторов узлов слева и их максимального идентификатора группы из ранее созданной таблицы graph_edge.
Группировка по идентификатору узла слева.

Если аргумент `limit0` активирован, то в конце SQL-запроса будет добавлено `LIMIT 0`.
## Пример

Файл в формате sql в папке models. Название файла `graph_glue`

Содержимое файла:
```sql
-- depends_on: {{ ref('graph_edge') }}

{{ datacraft.graph() }}
```
